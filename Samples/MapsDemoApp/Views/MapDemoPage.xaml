<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:m="http://Superdev.Maui.Maps"
    xmlns:s="http://schemas.superdev.ch/dotnet/2021/maui"
    xmlns:views="clr-namespace:MapsDemoApp.Views"
    xmlns:vm="clr-namespace:MapsDemoApp.ViewModels"
    x:Class="MapsDemoApp.Views.MapDemoPage"
    Title="Superdev.Maui.Maps Demo"
    x:DataType="vm:MapDemoViewModel">

    <ContentPage.Behaviors>
        <s:EventToCommandBehavior
            Command="{Binding AppearingCommand}"
            EventName="Appearing" />
    </ContentPage.Behaviors>

    <Grid>
        <Grid RowDefinitions="*, Auto">
            <m:CustomMap
                x:Name="ThisNeedsToBeHereOtherwiseYouGetAStupidCannotResolveTypeError"
                Grid.Row="0"
                CenterPosition="{Binding CurrentPosition, Mode=OneWay}"
                IsReadonly="{Binding IsReadonly}"
                IsShowingUser="{Binding IsShowingUser}"
                ItemsSource="{Binding ParkingLots}"
                MapElements="{Binding MapElements}"
                MapSpan="{Binding MapSpan}"
                MapType="Street"
                SelectedItem="{Binding SelectedParkingLot}"
                ZoomLevel="{Binding ZoomLevel, Mode=OneWay}">
                <m:CustomMap.ItemTemplate>
                    <DataTemplate x:DataType="vm:ParkingLotViewModel">
                        <m:CustomPin
                            Anchor="{Binding Anchor}"
                            ImageSource="{Binding Source={x:RelativeSource Self}, Path=IsSelected, Converter={StaticResource BoolToPushPinImageSourceConverter}}"
                            Location="{Binding Location}" />
                    </DataTemplate>
                </m:CustomMap.ItemTemplate>
            </m:CustomMap>

            <views:BottomMenu Grid.Row="1" />
        </Grid>

        <s:PageActivityIndicator
            Grid.Row="0"
            IsBusy="{Binding IsBusy}" />
    </Grid>
</ContentPage>